import{u as R,r,i as A,h as T,o as e,c as o,F as b,P as w,S as I,Y as V,b as t,j as z,Q as k,f as x,q as U,d as N,_ as q,U as H,I as J,J as P,X as K,w as W,e as C,g as Z}from"./app.6c603b3d.js";import{A as tt}from"./AppResultTable.317aa4ba.js";import{A as et}from"./logo.6cb82b19.js";import{A as B}from"./AppEditor.9a61aee0.js";import{A as at}from"./AppHeader.50170d3c.js";const st=["onUpdate:modelValue","placeholder"],ot={__name:"AppRaceColumn",props:["raceId"],emits:["update"],setup(h,{emit:n}){const u=h,i=R(),s=r([]),y=r(0);A(async()=>{const d=await T.get(`/api/admin/race/${u.raceId}`);s.value=d.data,y.value=Object.keys(s.value).length+1});const $=async()=>{try{await T.post(`/api/admin/race/${u.raceId}/results`,{result:s.value}),i.dispatch("notification/displayMessage",{value:"\u0414\u0430\u043D\u043D\u044B\u0435 \u0433\u043E\u043D\u043A\u0438 \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u044B",type:"primary"}),n("update")}catch{i.dispatch("notification/displayMessage",{value:"\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u0438\u0438 \u0434\u0430\u043D\u043D\u044B\u0445 \u0433\u043E\u043D\u043A\u0438",type:"error"})}};return(d,c)=>(e(),o(b,null,[(e(!0),o(b,null,w(s.value,(a,_)=>(e(),o("div",{class:"race-table__item race-table__result",key:_},[I(t("input",{type:"text","onUpdate:modelValue":l=>s.value[_]=l,placeholder:`${_}`},null,8,st),[[V,s.value[_]]])]))),128)),t("div",{class:"race-table__item race-table__result"},[t("button",{onClick:$},"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C")])],64))}},lt={class:"race-table"},nt={key:0},it={class:"race-table__header"},rt={class:"race-table__row"},ct=t("div",{class:"race-table__item race-table__name"},"\u041A\u043E\u043C\u0430\u043D\u0434\u0430",-1),ut=t("div",{class:"race-table__item race-table__total"},"\u0418\u0442\u043E\u0433",-1),dt={class:"race-table__body"},pt={class:"race-table__column"},_t={key:0,class:"race-table__item race-table__result"},vt=["onClick"],mt={class:"race-table__column"},ft={__name:"AppRaceTable",props:["stageId","status","groupId"],setup(h){const n=h,u=r({}),i=r({}),s=r(),y=r(),$=r({default:"\u0413\u043E\u043D\u043A\u0430",group:"\u0413\u0440\u0443\u043F\u043F\u0430",fleet:"\u0424\u043B\u043E\u0442"}),d=z(()=>{var l;return(l=Object.keys(u.value).length)!=null?l:0}),c=async()=>{try{const l=await axios.get(`/api/admin/stage/${n.stageId}/${n.groupId}/${n.status}/total`);y.value=l.data}catch(l){console.log(l.message)}};A(async()=>{try{const l=await axios.get(`/api/admin/stage/${n.stageId}/races/${n.status}/group/${n.groupId}`);u.value=l.data,s.value=u.value[0].race_id;const m=await axios.get(`/api/admin/race/${s.value}/teams`);i.value=m.data,await c()}catch(l){console.log(l.message)}});const a=async()=>{try{const m=(await axios.post("/api/admin/race/create",{stage_id:n.stageId,group_id:n.groupId,status:n.status,lastRaceId:s.value})).data;u.value.push({race_id:m.id,group_id:m.group_id,status:m.status}),await c()}catch(l){console.log(l.message)}},_=async l=>{try{await axios.post(`/api/admin/race/${l}/remove`),u.value.splice(u.value.findIndex(m=>m.race_id===l),1),await c()}catch(m){console.log(m.message)}};return(l,m)=>(e(),o("div",lt,[l.$props.status?(e(),o("h2",nt,k($.value[l.$props.status])+" #"+k(l.$props.groupId),1)):x("",!0),t("button",{class:"btn btn-default btn-settings mb15",onClick:a},"\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u0433\u043E\u043D\u043A\u0443"),t("div",it,[t("div",rt,[ct,(e(!0),o(b,null,w(U(d),f=>(e(),o("div",{class:"race-table__item race-table__result",key:f},"#"+k(f),1))),128)),ut])]),t("div",dt,[t("div",pt,[(e(!0),o(b,null,w(i.value,f=>(e(),o("div",{class:"race-table__item race-table__name",key:f.team_id},k(f.team_name),1))),128))]),(e(!0),o(b,null,w(u.value,(f,S)=>(e(),o("div",{class:"race-table__column",key:f.race_id},[N(ot,{raceId:f.race_id,onUpdate:c},null,8,["raceId"]),u.value.length>1&&S+1!==1?(e(),o("div",_t,[t("button",{onClick:M=>_(f.race_id)},"\u0423\u0434\u0430\u043B\u0438\u0442\u044C",8,vt)])):x("",!0)]))),128)),t("div",mt,[(e(!0),o(b,null,w(y.value,(f,S)=>(e(),o("div",{class:"race-table__item race-table__total",key:S},k(f),1))),128))])])]))}},gt={__name:"TheStageStatus",props:["status","id"],emits:["update"],setup(h,{emit:n}){const u=h,i=r(u.status),s=u.id,y=R(),$=async()=>{try{const a=await T.post(`/api/admin/stage/${s}/start`);i.value=a.data.status,n("update",i.value)}catch(a){console.log(a.message),y.dispatch("notification/displayMessage",{value:a.response.data.message,type:"error"})}},d=async()=>{try{const a=await T.post(`/api/admin/stage/${s}/finish-group`);i.value=a.data.status,n("update",i.value)}catch(a){console.log(a.message),y.dispatch("notification/displayMessage",{value:a.response.data.message,type:"error"})}},c=async()=>{try{const a=await T.post(`/api/admin/stage/${s}/finish`);i.value=a.data.status,n("update",i.value)}catch(a){console.log(a.message),y.dispatch("notification/displayMessage",{value:a.response.data.message,type:"error"})}};return(a,_)=>(e(),o(b,null,[i.value==="active"?(e(),o("button",{key:0,class:"btn btn-default btn-settings",onClick:$},"\u041D\u0430\u0447\u0430\u0442\u044C \u044D\u0442\u0430\u043F")):x("",!0),i.value==="group"?(e(),o("button",{key:1,class:"btn btn-default btn-settings",onClick:d},"\u0417\u0430\u0432\u0435\u0440\u0448\u0438\u0442\u044C \u0433\u0440\u0443\u043F\u043F\u043E\u0432\u043E\u0439 \u044D\u0442\u0430\u043F")):x("",!0),i.value==="default"||i.value==="fleet"?(e(),o("button",{key:2,class:"btn btn-default btn-settings",onClick:c},"\u0417\u0430\u0432\u0435\u0440\u0448\u0438\u0442\u044C \u0440\u0435\u0433\u0430\u0442\u0443")):x("",!0)],64))}};const D=h=>(J("data-v-86f09e6f"),h=h(),P(),h),ht={class:"dashboard-item"},yt=D(()=>t("h3",null,"\u0417\u0430\u0433\u0440\u0443\u0436\u0435\u043D\u043D\u044B\u0435 \u0444\u0430\u0439\u043B\u044B",-1)),bt={class:"docs-container"},$t=["onClick"],xt=["href"],kt={key:0,class:"ri-file-pdf-2-line"},wt=["src"],It={class:"docs-title"},Vt={class:"dashboard-item"},St=D(()=>t("h3",null,"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044C \u0444\u0430\u0439\u043B\u044B",-1)),Ct=["onSubmit"],Ut={class:"form-control"},Mt=D(()=>t("label",{for:"file"},"\u0424\u0430\u0439\u043B",-1)),Tt={class:"form-control"},At=D(()=>t("label",{for:"title"},"\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435",-1)),Dt=D(()=>t("button",{class:"btn btn-default btn-settings"},"\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C",-1)),Ft={__name:"StageFiles",props:["id"],setup(h){const n=h,u=r([]),i=r(),s=r();A(async()=>{const d=await axios.get(`/api/admin/stage/${n.id}/files`);d.data.result&&(u.value=[...d.data.files])});const y=async()=>{const d=new FormData;if(d.append("file",i.value.files[0]),d.append("title",s.value),d.append("id",n.id),!i.value.files[0]||!s.value){alert("\u041E\u0448\u0438\u0431\u043A\u0430, \u043E\u0431\u0430 \u043F\u043E\u043B\u044F \u0434\u043E\u043B\u0436\u043D\u044B \u0431\u044B\u0442\u044C \u0437\u0430\u043F\u043E\u043B\u043D\u0435\u043D\u044B!");return}const c=await axios.post("/api/admin/stage/file",d,{headers:{"Content-Type":"multipart/form-data"}});c.data.result===!0&&(u.value.push(c.data.file),i.value=null,s.value=null)},$=async d=>{if((await axios.delete(`/api/admin/stage/file/${d}/delete`)).data.result){const a=u.value.findIndex(_=>_.id===d);u.value.splice(a,1)}};return(d,c)=>(e(),o(b,null,[t("div",ht,[yt,t("div",bt,[(e(!0),o(b,null,w(u.value,a=>(e(),o("div",{class:"docs-item",key:a.id},[t("div",{class:"doc-delete",onClick:_=>$(a.id)},"\u0423\u0434\u0430\u043B\u0438\u0442\u044C",8,$t),t("a",{href:"/storage/"+a.path,class:"docs-img",target:"_blank"},[a.path.includes("pdf")?(e(),o("i",kt)):(e(),o("img",{key:1,src:"/storage/"+a.path,alt:"doc-img"},null,8,wt))],8,xt),t("div",It,k(a.title),1)]))),128))])]),t("div",Vt,[St,t("form",{onSubmit:H(y,["prevent"])},[t("div",Ut,[Mt,t("input",{type:"file",id:"file",name:"file",ref_key:"fileInput",ref:i},null,512)]),t("div",Tt,[At,I(t("input",{class:"form-input",type:"text",name:"title","onUpdate:modelValue":c[0]||(c[0]=a=>s.value=a)},null,512),[[V,s.value]])]),Dt],40,Ct)])],64))}},Rt=q(Ft,[["__scopeId","data-v-86f09e6f"]]);const Gt=h=>(J("data-v-4b1ffacd"),h=h(),P(),h),jt={key:0,class:"result-table"},Bt=Gt(()=>t("thead",null,[t("tr",null,[t("th",null,"#"),t("th",null,"\u041A\u043E\u043C\u0430\u043D\u0434\u044B"),t("th",null,"\u0413\u0440\u0443\u043F\u043F\u0430"),t("th",null,"\u0423\u0434\u0430\u043B\u0435\u043D\u0438\u0435")])],-1)),Nt={class:"result-table__name"},Ot={class:"result-table__first"},Et={class:"result-table__second"},Lt=["onUpdate:modelValue"],qt=["onClick"],Ht={__name:"TeamsSplit",props:["id"],setup(h){const n=h,u=r([]),i=r({}),s=R(),y=async()=>{if(Object.keys(i.value).length!==u.value.length){s.dispatch("notification/displayMessage",{type:"error",value:"\u0420\u0430\u0441\u043F\u0440\u0435\u0434\u0435\u043B\u0438\u0442\u0435 \u0432\u0441\u0435 \u043A\u043E\u043C\u0430\u043D\u0434\u044B \u0438\u043B\u0438 \u0443\u0434\u0430\u043B\u0438\u0442\u0435 \u043B\u0438\u0448\u043D\u0438\u0435"});return}const c=await axios.post(`/api/admin/stage/${n.id}/group`,{groups:i.value});c.data.result?console.log(c.data):s.dispatch("notification/displayMessage",{type:"error",value:"\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u043E\u043F\u0440\u043E\u0431\u0443\u0439\u0442\u0435 \u043F\u043E\u0437\u0436\u0435"})},$=async c=>{const a=await axios.post(`/api/admin/remove-team/${c}/stage/${n.id}`);a.data.result?(s.dispatch("notification/displayMessage",{type:"primary",value:"\u041A\u043E\u043C\u0430\u043D\u0434\u0430 \u0443\u0434\u0430\u043B\u0435\u043D\u0430"}),await d()):s.dispatch("notification/displayMessage",{type:"error",value:a.data.msg})},d=async()=>{const c=await axios.get(`/api/admin/team/users/${n.id}`);c.data.result&&(u.value=c.data.teams)};return A(async()=>{await d()}),(c,a)=>(e(),o(b,null,[u.value.length>0?(e(),o("table",jt,[Bt,t("tbody",null,[(e(!0),o(b,null,w(u.value,(_,l)=>(e(),o("tr",{key:l},[t("td",null,k(l+1),1),t("td",null,[t("div",Nt,[t("div",Ot,k(_.team_name),1),t("div",Et,[(e(!0),o(b,null,w(_.users,m=>(e(),o("span",{key:m.id},k(m.surname)+" "+k(m.name)+" "+k(m.patronymic),1))),128))])])]),t("td",null,[I(t("input",{class:"split-number-input",type:"number","onUpdate:modelValue":m=>i.value[_.team_id]=m},null,8,Lt),[[V,i.value[_.team_id]]])]),t("td",null,[t("button",{class:"btn btn-default btn-settings",onClick:m=>$(_.team_id)},"\u0423\u0434\u0430\u043B\u0438\u0442\u044C",8,qt)])]))),128))])])):x("",!0),t("button",{class:"btn btn-default btn-settings",onClick:y},"\u0421\u0444\u043E\u0440\u043C\u0438\u0440\u043E\u0432\u0430\u0442\u044C \u0433\u0440\u0443\u043F\u043F\u044B")],64))}},Jt=q(Ht,[["__scopeId","data-v-4b1ffacd"]]),Pt={class:"container-fluid g-0"},Qt={class:"row"},Xt={class:"col-12"},Yt={class:"dashboard-item"},zt=["onSubmit"],Kt={class:"form-control"},Wt=t("label",{for:"register_start"},"\u041D\u0430\u0447\u0430\u043B\u043E \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u0438",-1),Zt={class:"form-control"},te=t("label",{for:"register_end"},"\u041A\u043E\u043D\u0435\u0446 \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u0438",-1),ee={class:"form-control"},ae=t("label",{for:"title"},"\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u042D\u0442\u0430\u043F\u0430",-1),se={class:"form-control"},oe=t("label",{for:"race_amount_drop"},"\u041A\u043E\u043B-\u0432\u043E \u0432\u044B\u0431\u0440\u043E\u0441\u043E\u0432 (\u0434\u043E 18 \u0447\u0435\u043B\u043E\u0432)",-1),le={class:"form-control"},ne=t("label",{for:"race_amount_drop"},"\u041A\u043E\u043B-\u0432\u043E \u0432\u044B\u0431\u0440\u043E\u0441\u043E\u0432 \u0432 \u0433\u0440\u0443\u043F\u043F\u0430\u0445 (\u043E\u0442 19 \u0447\u0435\u043B\u043E\u0432)",-1),ie={class:"form-control"},re=t("label",{for:"race_amount_drop"},"\u041A\u043E\u043B-\u0432\u043E \u0432\u044B\u0431\u0440\u043E\u0441\u043E\u0432 \u0432\u043E \u0444\u043B\u043E\u0442\u0430\u0445 (\u043E\u0442 19 \u0447\u0435\u043B\u043E\u0432)",-1),ce={class:"form-control"},ue=t("label",{for:"excerpt"},"\u041A\u0440\u0430\u0442\u043A\u043E\u0435 \u043E\u043F\u0438\u0441\u0430\u043D\u0438\u0435",-1),de={class:"form-control"},pe=t("label",{for:"description"},"\u041E\u043F\u0438\u0441\u0430\u043D\u0438\u0435",-1),_e={class:"form-control"},ve=t("label",{for:"participant_text"},"\u0414\u043B\u044F \u0443\u0447\u0430\u0441\u0442\u043D\u0438\u043A\u043E\u0432",-1),me=t("button",{class:"btn btn-default btn-settings"},"\u0420\u0435\u0434\u0430\u043A\u0442\u0438\u0440\u043E\u0432\u0430\u0442\u044C",-1),fe={class:"col-12"},ge={class:"col-12"},he={class:"dashboard-item"},we={__name:"edit",setup(h){const n=r(!1),u=K(),i=R(),s=u.params.id,y=r(),$=r(""),d=r(""),c=r(""),a=r(""),_=r(""),l=r(""),m=r(),f=r(),S=r(),M=r(),F=r(),G=r(null),O=r(),j=r(1),E=async p=>{try{const v=await axios.get(`/api/admin/stage/${s}/meta`);O.value=v.data,f.value=p,j.value&&j.value++}catch(v){console.log(v.message)}};A(async()=>{n.value=!0;try{const p=await axios.get(`/api/admin/stage/${s}/edit`);c.value=y.value=p.data.title,$.value=p.data.register_start,d.value=p.data.register_end,a.value=p.data.excerpt?p.data.excerpt:" ",_.value=p.data.description?p.data.description:" ",l.value=p.data.participant_text?p.data.participant_text:" ",m.value=p.data.users,S.value=p.data.race_amount_drop,M.value=p.data.race_amount_group_drop,F.value=p.data.race_amount_fleet_drop,await E(p.data.status),n.value=!1}catch(p){console.log(p.message),n.value=!1}});const Q=async()=>{n.value=!0;try{if(await axios.patch(`/api/admin/stage/${s}/update`,{title:c.value,description:_.value,excerpt:a.value,participant_text:l.value,register_start:$.value,register_end:d.value,race_amount_drop:S.value,race_amount_group_drop:M.value,race_amount_fleet_drop:F.value}),G.value)for(let p of G.value)p.getTotal();i.dispatch("notification/displayMessage",{value:"\u042D\u0442\u0430\u043F \u0443\u0441\u043F\u0435\u0448\u043D\u043E \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D",type:"primary"}),n.value=!1}catch(p){console.log(p.message),i.dispatch("notification/displayMessage",{value:"\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u0438\u0438 \u044D\u0442\u0430\u043F\u0430",type:"error"}),n.value=!1}};return(p,v)=>(e(),o(b,null,[N(at,null,{default:W(()=>[Z(k(y.value),1)]),_:1}),t("main",null,[t("div",Pt,[t("div",Qt,[t("div",Xt,[t("div",Yt,[n.value?(e(),C(et,{key:0})):x("",!0),t("form",{onSubmit:H(Q,["prevent"])},[t("div",Kt,[Wt,I(t("input",{class:"form-input",type:"datetime-local",id:"register_start","onUpdate:modelValue":v[0]||(v[0]=g=>$.value=g)},null,512),[[V,$.value]])]),t("div",Zt,[te,I(t("input",{class:"form-input",type:"datetime-local",id:"register_end","onUpdate:modelValue":v[1]||(v[1]=g=>d.value=g)},null,512),[[V,d.value]])]),t("div",ee,[ae,I(t("input",{class:"form-input",type:"text",id:"title","onUpdate:modelValue":v[2]||(v[2]=g=>c.value=g),placeholder:"\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u044D\u0442\u0430\u043F\u0430"},null,512),[[V,c.value]])]),t("div",se,[oe,I(t("input",{class:"form-input",type:"text",id:"race_amount_drop","onUpdate:modelValue":v[3]||(v[3]=g=>S.value=g),placeholder:"\u041A\u043E\u043B-\u0432\u043E \u0432\u044B\u0431\u0440\u043E\u0441\u043E\u0432 (\u0434\u043E 18 \u0447\u0435\u043B\u043E\u0432)"},null,512),[[V,S.value]])]),t("div",le,[ne,I(t("input",{class:"form-input",type:"text",id:"race_amount_group_drop","onUpdate:modelValue":v[4]||(v[4]=g=>M.value=g),placeholder:"\u041A\u043E\u043B-\u0432\u043E \u0432\u044B\u0431\u0440\u043E\u0441\u043E\u0432 \u0432 \u0433\u0440\u0443\u043F\u043F\u0430\u0445 (\u043E\u0442 19 \u0447\u0435\u043B\u043E\u0432)"},null,512),[[V,M.value]])]),t("div",ie,[re,I(t("input",{class:"form-input",type:"text",id:"race_amount_fleet_drop","onUpdate:modelValue":v[5]||(v[5]=g=>F.value=g),placeholder:"\u041A\u043E\u043B-\u0432\u043E \u0432\u044B\u0431\u0440\u043E\u0441\u043E\u0432 \u0432\u043E \u0444\u043B\u043E\u0442\u0430\u0445 (\u043E\u0442 19 \u0447\u0435\u043B\u043E\u0432)"},null,512),[[V,F.value]])]),t("div",ce,[ue,a.value?(e(),C(B,{key:0,modelValue:a.value,"onUpdate:modelValue":v[6]||(v[6]=g=>a.value=g),id:"excerpt"},null,8,["modelValue"])):x("",!0)]),t("div",de,[pe,_.value?(e(),C(B,{key:0,modelValue:_.value,"onUpdate:modelValue":v[7]||(v[7]=g=>_.value=g),id:"description"},null,8,["modelValue"])):x("",!0)]),t("div",_e,[ve,l.value?(e(),C(B,{key:0,modelValue:l.value,"onUpdate:modelValue":v[8]||(v[8]=g=>l.value=g),id:"participant_text"},null,8,["modelValue"])):x("",!0)]),me],40,zt)])]),t("div",fe,[N(Rt,{id:U(s)},null,8,["id"])]),t("div",ge,[t("div",he,[f.value==="active"?(e(),C(Jt,{key:0,id:U(s)},null,8,["id"])):x("",!0),f.value!=="finished"&&f.value!=="active"?(e(!0),o(b,{key:1},w(O.value,(g,X,Y)=>(e(),o("div",{class:"stage-table",key:Y},[(e(!0),o(b,null,w(g,L=>(e(),C(ft,{stageId:U(s),groupId:L,status:X,key:L,ref_for:!0,ref_key:"child",ref:G},null,8,["stageId","groupId","status"]))),128))]))),128)):x("",!0),f.value?(e(),C(gt,{key:2,status:f.value,id:U(s),onUpdate:E},null,8,["status","id"])):x("",!0),f.value!=="active"?(e(),C(tt,{id:U(s),key:j.value},null,8,["id"])):x("",!0)])])])])])],64))}};export{we as default};
