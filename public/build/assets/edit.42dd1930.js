import{_ as j,u as E,r as n,i as R,h as T,o as s,c as i,F as y,P as C,S as I,Y as V,b as t,j as X,Q as k,f as b,q as A,d as N,U as H,I as Y,J as z,X as K,w as W,e as w,g as Z}from"./app.9fdc73f6.js";import{a as tt,A as et}from"./AppUsersTables.46017cff.js";import{A as at}from"./logo.43433f72.js";import{A as B}from"./AppEditor.af49474f.js";import{A as st}from"./AppHeader.32aaba5f.js";const ot={name:"AppRaceColumn",props:["raceId"],emits:["update"],setup(g,{emit:a}){const l=E(),e=n([]),r=n(0);return R(async()=>{const _=await T.get(`/api/admin/race/${g.raceId}`);e.value=_.data,r.value=Object.keys(e.value).length+1}),{submit:async()=>{try{await T.post(`/api/admin/race/${g.raceId}/results`,{result:e.value}),l.dispatch("notification/displayMessage",{value:"\u0414\u0430\u043D\u043D\u044B\u0435 \u0433\u043E\u043D\u043A\u0438 \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u044B",type:"primary"}),a("update")}catch{l.dispatch("notification/displayMessage",{value:"\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u0438\u0438 \u0434\u0430\u043D\u043D\u044B\u0445 \u0433\u043E\u043D\u043A\u0438",type:"error"})}},result:e,userAmount:r}}},lt=["onUpdate:modelValue","placeholder"],nt={class:"race-table__item race-table__result"};function it(g,a,l,e,r,$){return s(),i(y,null,[(s(!0),i(y,null,C(e.result,(_,d)=>(s(),i("div",{class:"race-table__item race-table__result",key:d},[I(t("input",{type:"text","onUpdate:modelValue":o=>e.result[d]=o,placeholder:`(dnf, ${e.userAmount})`},null,8,lt),[[V,e.result[d]]])]))),128)),t("div",nt,[t("button",{onClick:a[0]||(a[0]=(..._)=>e.submit&&e.submit(..._))},"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C")])],64)}const rt=j(ot,[["render",it]]),ut={class:"race-table"},dt={key:0},ct={class:"race-table__header"},pt={class:"race-table__row"},_t=t("div",{class:"race-table__item race-table__name"},"\u042F\u0445\u0442\u0441\u043C\u0435\u043D",-1),mt=t("div",{class:"race-table__item race-table__total"},"\u0418\u0442\u043E\u0433",-1),vt={class:"race-table__body"},ft={class:"race-table__column"},gt={key:0,class:"race-table__item race-table__result"},ht=["onClick"],bt={class:"race-table__column"},yt={__name:"AppRaceTable",props:["stageId","status","groupId"],setup(g){const a=g,l=n({}),e=n({}),r=n(),$=n(),_=n({default:"\u0413\u043E\u043D\u043A\u0430",group:"\u0413\u0440\u0443\u043F\u043F\u0430",fleet:"\u0424\u043B\u043E\u0442"}),d=X(()=>{var u;return(u=Object.keys(l.value).length)!=null?u:0}),o=async()=>{try{const u=await axios.get(`/api/admin/stage/${a.stageId}/${a.groupId}/${a.status}/total`);$.value=u.data}catch(u){console.log(u.message)}};R(async()=>{try{const u=await axios.get(`/api/admin/stage/${a.stageId}/races/${a.status}/group/${a.groupId}`);l.value=u.data,r.value=l.value[0].race_id;const h=await axios.get(`/api/admin/race/${r.value}/users`);e.value=h.data,await o()}catch(u){console.log(u.message)}});const f=async()=>{try{const h=(await axios.post("/api/admin/race/create",{stage_id:a.stageId,group_id:a.groupId,status:a.status,lastRaceId:r.value})).data;l.value.push({race_id:h.id,group_id:h.group_id,status:h.status}),await o()}catch(u){console.log(u.message)}},x=async u=>{try{await axios.post(`/api/admin/race/${u}/remove`),l.value.splice(l.value.findIndex(h=>h.race_id===u),1),await o()}catch(h){console.log(h.message)}};return(u,h)=>(s(),i("div",ut,[u.$props.status?(s(),i("h2",dt,k(_.value[u.$props.status])+" #"+k(u.$props.groupId),1)):b("",!0),t("button",{class:"btn btn-default btn-settings mb15",onClick:f},"\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u0433\u043E\u043D\u043A\u0443"),t("div",ct,[t("div",pt,[_t,(s(!0),i(y,null,C(A(d),m=>(s(),i("div",{class:"race-table__item race-table__result",key:m},"#"+k(m),1))),128)),mt])]),t("div",vt,[t("div",ft,[(s(!0),i(y,null,C(e.value,m=>(s(),i("div",{class:"race-table__item race-table__name",key:m.user_id},k(m.id)+" "+k(m.surname)+" "+k(m.name),1))),128))]),(s(!0),i(y,null,C(l.value,(m,S)=>(s(),i("div",{class:"race-table__column",key:m.race_id},[N(rt,{raceId:m.race_id,onUpdate:o},null,8,["raceId"]),l.value.length>1&&S+1!==1?(s(),i("div",gt,[t("button",{onClick:U=>x(m.race_id)},"\u0423\u0434\u0430\u043B\u0438\u0442\u044C",8,ht)])):b("",!0)]))),128)),t("div",bt,[(s(!0),i(y,null,C($.value,(m,S)=>(s(),i("div",{class:"race-table__item race-table__total",key:S},k(m),1))),128))])])]))}},$t={name:"TheStageStatus",emits:["update"],props:["status","id"],setup(g,{emit:a}){const l=n(g.status),e=g.id,r=E();return{status:l,startStage:async()=>{try{const o=await T.post(`/api/admin/stage/${e}/start`);l.value=o.data.status,a("update",l.value)}catch(o){console.log(o.message),r.dispatch("notification/displayMessage",{value:o.response.data.message,type:"error"})}},finishGroupStage:async()=>{try{const o=await T.post(`/api/admin/stage/${e}/finish-group`);l.value=o.data.status,a("update",l.value)}catch(o){console.log(o.message),r.dispatch("notification/displayMessage",{value:o.response.data.message,type:"error"})}},id:e,finishStage:async()=>{try{const o=await T.post(`/api/admin/stage/${e}/finish`);l.value=o.data.status,a("update",l.value)}catch(o){console.log(o.message),r.dispatch("notification/displayMessage",{value:o.response.data.message,type:"error"})}}}}};function xt(g,a,l,e,r,$){return s(),i(y,null,[e.status==="active"?(s(),i("button",{key:0,class:"btn btn-default btn-settings mb30",onClick:a[0]||(a[0]=(..._)=>e.startStage&&e.startStage(..._))},"\u041D\u0430\u0447\u0430\u0442\u044C \u044D\u0442\u0430\u043F")):b("",!0),e.status==="group"?(s(),i("button",{key:1,class:"btn btn-default btn-settings mb30",onClick:a[1]||(a[1]=(..._)=>e.finishGroupStage&&e.finishGroupStage(..._))},"\u0417\u0430\u0432\u0435\u0440\u0448\u0438\u0442\u044C \u0433\u0440\u0443\u043F\u043F\u043E\u0432\u043E\u0439 \u044D\u0442\u0430\u043F")):b("",!0),e.status==="default"||e.status==="fleet"?(s(),i("button",{key:2,class:"btn btn-default btn-settings mb30",onClick:a[2]||(a[2]=(..._)=>e.finishStage&&e.finishStage(..._))},"\u0417\u0430\u0432\u0435\u0440\u0448\u0438\u0442\u044C \u0440\u0435\u0433\u0430\u0442\u0443")):b("",!0)],64)}const kt=j($t,[["render",xt]]);const M=g=>(Y("data-v-86f09e6f"),g=g(),z(),g),St={class:"dashboard-item"},wt=M(()=>t("h3",null,"\u0417\u0430\u0433\u0440\u0443\u0436\u0435\u043D\u043D\u044B\u0435 \u0444\u0430\u0439\u043B\u044B",-1)),It={class:"docs-container"},Vt=["onClick"],Ct=["href"],Ut={key:0,class:"ri-file-pdf-2-line"},At=["src"],Tt={class:"docs-title"},Mt={class:"dashboard-item"},Dt=M(()=>t("h3",null,"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044C \u0444\u0430\u0439\u043B\u044B",-1)),Rt=["onSubmit"],Ft={class:"form-control"},Gt=M(()=>t("label",{for:"file"},"\u0424\u0430\u0439\u043B",-1)),Bt={class:"form-control"},Nt=M(()=>t("label",{for:"title"},"\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435",-1)),jt=M(()=>t("button",{class:"btn btn-default btn-settings"},"\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C",-1)),Et={__name:"StageFiles",props:["id"],setup(g){const a=g,l=n([]),e=n(),r=n();R(async()=>{const d=await axios.get(`/api/admin/stage/${a.id}/files`);d.data.result&&(l.value=[...d.data.files])});const $=async()=>{const d=new FormData;if(d.append("file",e.value.files[0]),d.append("title",r.value),d.append("id",a.id),!e.value.files[0]||!r.value){alert("\u041E\u0448\u0438\u0431\u043A\u0430, \u043E\u0431\u0430 \u043F\u043E\u043B\u044F \u0434\u043E\u043B\u0436\u043D\u044B \u0431\u044B\u0442\u044C \u0437\u0430\u043F\u043E\u043B\u043D\u0435\u043D\u044B!");return}const o=await axios.post("/api/admin/stage/file",d,{headers:{"Content-Type":"multipart/form-data"}});o.data.result===!0&&(l.value.push(o.data.file),e.value=null,r.value=null)},_=async d=>{if((await axios.delete(`/api/admin/stage/file/${d}/delete`)).data.result){const f=l.value.findIndex(x=>x.id===d);l.value.splice(f,1)}};return(d,o)=>(s(),i(y,null,[t("div",St,[wt,t("div",It,[(s(!0),i(y,null,C(l.value,f=>(s(),i("div",{class:"docs-item",key:f.id},[t("div",{class:"doc-delete",onClick:x=>_(f.id)},"\u0423\u0434\u0430\u043B\u0438\u0442\u044C",8,Vt),t("a",{href:"/storage/"+f.path,class:"docs-img",target:"_blank"},[f.path.includes("pdf")?(s(),i("i",Ut)):(s(),i("img",{key:1,src:"/storage/"+f.path,alt:"doc-img"},null,8,At))],8,Ct),t("div",Tt,k(f.title),1)]))),128))])]),t("div",Mt,[Dt,t("form",{onSubmit:H($,["prevent"])},[t("div",Ft,[Gt,t("input",{type:"file",id:"file",name:"file",ref_key:"fileInput",ref:e},null,512)]),t("div",Bt,[Nt,I(t("input",{class:"form-input",type:"text",name:"title","onUpdate:modelValue":o[0]||(o[0]=f=>r.value=f)},null,512),[[V,r.value]])]),jt],40,Rt)])],64))}},Lt=j(Et,[["__scopeId","data-v-86f09e6f"]]),Ot={class:"container-fluid g-0"},qt={class:"row"},Ht={class:"col-12"},Jt={class:"dashboard-item"},Pt=["onSubmit"],Qt={class:"form-control"},Xt=t("label",{for:"register_start"},"\u041D\u0430\u0447\u0430\u043B\u043E \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u0438",-1),Yt={class:"form-control"},zt=t("label",{for:"register_end"},"\u041A\u043E\u043D\u0435\u0446 \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u0438",-1),Kt={class:"form-control"},Wt=t("label",{for:"title"},"\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u042D\u0442\u0430\u043F\u0430",-1),Zt={class:"form-control"},te=t("label",{for:"race_amount_drop"},"\u041A\u043E\u043B-\u0432\u043E \u0432\u044B\u0431\u0440\u043E\u0441\u043E\u0432 (\u0434\u043E 18 \u0447\u0435\u043B\u043E\u0432)",-1),ee={class:"form-control"},ae=t("label",{for:"race_amount_drop"},"\u041A\u043E\u043B-\u0432\u043E \u0432\u044B\u0431\u0440\u043E\u0441\u043E\u0432 \u0432 \u0433\u0440\u0443\u043F\u043F\u0430\u0445 (\u043E\u0442 19 \u0447\u0435\u043B\u043E\u0432)",-1),se={class:"form-control"},oe=t("label",{for:"race_amount_drop"},"\u041A\u043E\u043B-\u0432\u043E \u0432\u044B\u0431\u0440\u043E\u0441\u043E\u0432 \u0432\u043E \u0444\u043B\u043E\u0442\u0430\u0445 (\u043E\u0442 19 \u0447\u0435\u043B\u043E\u0432)",-1),le={class:"form-control"},ne=t("label",{for:"excerpt"},"\u041A\u0440\u0430\u0442\u043A\u043E\u0435 \u043E\u043F\u0438\u0441\u0430\u043D\u0438\u0435",-1),ie={class:"form-control"},re=t("label",{for:"description"},"\u041E\u043F\u0438\u0441\u0430\u043D\u0438\u0435",-1),ue={class:"form-control"},de=t("label",{for:"participant_text"},"\u0414\u043B\u044F \u0443\u0447\u0430\u0441\u0442\u043D\u0438\u043A\u043E\u0432",-1),ce=t("button",{class:"btn btn-default btn-settings"},"\u0420\u0435\u0434\u0430\u043A\u0442\u0438\u0440\u043E\u0432\u0430\u0442\u044C",-1),pe={class:"col-12"},_e={class:"col-12"},me={class:"dashboard-item"},ye={__name:"edit",setup(g){const a=n(!1),l=K(),e=E(),r=l.params.id,$=n(),_=n(""),d=n(""),o=n(""),f=n(""),x=n(""),u=n(""),h=n(),m=n(),S=n(),U=n(),D=n(),F=n(null),L=n(),G=n(),O=async c=>{try{const p=await axios.get(`/api/admin/stage/${r}/meta`);L.value=p.data,m.value=c,G.value&&G.value.update()}catch(p){console.log(p.message)}};R(async()=>{a.value=!0;try{const c=await axios.get(`/api/admin/stage/${r}/edit`);o.value=$.value=c.data.title,_.value=c.data.register_start,d.value=c.data.register_end,f.value=c.data.excerpt?c.data.excerpt:" ",x.value=c.data.description?c.data.description:" ",u.value=c.data.participant_text?c.data.participant_text:" ",h.value=c.data.users,S.value=c.data.race_amount_drop,U.value=c.data.race_amount_group_drop,D.value=c.data.race_amount_fleet_drop,await O(c.data.status),a.value=!1}catch(c){console.log(c.message),a.value=!1}});const J=async()=>{a.value=!0;try{if(await axios.patch(`/api/admin/stage/${r}/update`,{title:o.value,description:x.value,excerpt:f.value,participant_text:u.value,register_start:_.value,register_end:d.value,race_amount_drop:S.value,race_amount_group_drop:U.value,race_amount_fleet_drop:D.value}),F.value)for(let c of F.value)c.getTotal();e.dispatch("notification/displayMessage",{value:"\u042D\u0442\u0430\u043F \u0443\u0441\u043F\u0435\u0448\u043D\u043E \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D",type:"primary"}),a.value=!1}catch(c){console.log(c.message),e.dispatch("notification/displayMessage",{value:"\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u0438\u0438 \u044D\u0442\u0430\u043F\u0430",type:"error"}),a.value=!1}};return(c,p)=>(s(),i(y,null,[N(st,null,{default:W(()=>[Z(k($.value),1)]),_:1}),t("main",null,[t("div",Ot,[t("div",qt,[t("div",Ht,[t("div",Jt,[a.value?(s(),w(at,{key:0})):b("",!0),t("form",{onSubmit:H(J,["prevent"])},[t("div",Qt,[Xt,I(t("input",{class:"form-input",type:"datetime-local",id:"register_start","onUpdate:modelValue":p[0]||(p[0]=v=>_.value=v)},null,512),[[V,_.value]])]),t("div",Yt,[zt,I(t("input",{class:"form-input",type:"datetime-local",id:"register_end","onUpdate:modelValue":p[1]||(p[1]=v=>d.value=v)},null,512),[[V,d.value]])]),t("div",Kt,[Wt,I(t("input",{class:"form-input",type:"text",id:"title","onUpdate:modelValue":p[2]||(p[2]=v=>o.value=v),placeholder:"\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u044D\u0442\u0430\u043F\u0430"},null,512),[[V,o.value]])]),t("div",Zt,[te,I(t("input",{class:"form-input",type:"text",id:"race_amount_drop","onUpdate:modelValue":p[3]||(p[3]=v=>S.value=v),placeholder:"\u041A\u043E\u043B-\u0432\u043E \u0432\u044B\u0431\u0440\u043E\u0441\u043E\u0432 (\u0434\u043E 18 \u0447\u0435\u043B\u043E\u0432)"},null,512),[[V,S.value]])]),t("div",ee,[ae,I(t("input",{class:"form-input",type:"text",id:"race_amount_group_drop","onUpdate:modelValue":p[4]||(p[4]=v=>U.value=v),placeholder:"\u041A\u043E\u043B-\u0432\u043E \u0432\u044B\u0431\u0440\u043E\u0441\u043E\u0432 \u0432 \u0433\u0440\u0443\u043F\u043F\u0430\u0445 (\u043E\u0442 19 \u0447\u0435\u043B\u043E\u0432)"},null,512),[[V,U.value]])]),t("div",se,[oe,I(t("input",{class:"form-input",type:"text",id:"race_amount_fleet_drop","onUpdate:modelValue":p[5]||(p[5]=v=>D.value=v),placeholder:"\u041A\u043E\u043B-\u0432\u043E \u0432\u044B\u0431\u0440\u043E\u0441\u043E\u0432 \u0432\u043E \u0444\u043B\u043E\u0442\u0430\u0445 (\u043E\u0442 19 \u0447\u0435\u043B\u043E\u0432)"},null,512),[[V,D.value]])]),t("div",le,[ne,f.value?(s(),w(B,{key:0,modelValue:f.value,"onUpdate:modelValue":p[6]||(p[6]=v=>f.value=v),id:"excerpt"},null,8,["modelValue"])):b("",!0)]),t("div",ie,[re,x.value?(s(),w(B,{key:0,modelValue:x.value,"onUpdate:modelValue":p[7]||(p[7]=v=>x.value=v),id:"description"},null,8,["modelValue"])):b("",!0)]),t("div",ue,[de,u.value?(s(),w(B,{key:0,modelValue:u.value,"onUpdate:modelValue":p[8]||(p[8]=v=>u.value=v),id:"participant_text"},null,8,["modelValue"])):b("",!0)]),ce],40,Pt)])]),t("div",pe,[N(Lt,{id:A(r)},null,8,["id"])]),t("div",_e,[t("div",me,[m.value==="active"&&h.value?(s(),w(tt,{key:0,users:h.value},null,8,["users"])):b("",!0),m.value!=="finished"&&m.value!=="active"?(s(!0),i(y,{key:1},C(L.value,(v,P,Q)=>(s(),i("div",{class:"stage-table",key:Q},[(s(!0),i(y,null,C(v,q=>(s(),w(yt,{stageId:A(r),groupId:q,status:P,key:q,ref_for:!0,ref_key:"child",ref:F},null,8,["stageId","groupId","status"]))),128))]))),128)):b("",!0),m.value?(s(),w(kt,{key:2,status:m.value,id:A(r),onUpdate:O},null,8,["status","id"])):b("",!0),m.value!=="active"?(s(),w(et,{key:3,id:A(r),ref_key:"resultComponent",ref:G},null,8,["id"])):b("",!0)])])])])])],64))}};export{ye as default};
