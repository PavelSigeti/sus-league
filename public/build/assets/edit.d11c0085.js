import{_ as O,u as F,r as c,i as T,h as M,o as e,c as l,F as b,P as V,S as w,Y as I,b as t,j as z,Q as k,f as x,q as U,d as N,U as H,I as J,J as P,X as K,w as W,e as C,g as Z}from"./app.935610ff.js";import{A as tt}from"./AppResultTable.67bb2a72.js";import{A as et}from"./logo.38533404.js";import{A as B}from"./AppEditor.b43b0ebc.js";import{A as at}from"./AppHeader.69c7222b.js";const st=["onUpdate:modelValue"],ot=["onUpdate:modelValue"],lt={__name:"AppRaceColumn",props:["raceId"],emits:["update"],setup(g,{emit:i}){const r=g,u=F(),o=c([]),h=c([]),$=c(0);T(async()=>{const n=await M.get(`/api/admin/race/${r.raceId}`);o.value=n.data.places,h.value=n.data.notes,$.value=Object.keys(o.value).length+1});const d=async()=>{try{await M.post(`/api/admin/race/${r.raceId}/results`,{result:o.value,notes:h.value}),u.dispatch("notification/displayMessage",{value:"\u0414\u0430\u043D\u043D\u044B\u0435 \u0433\u043E\u043D\u043A\u0438 \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u044B",type:"primary"}),i("update")}catch{u.dispatch("notification/displayMessage",{value:"\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u0438\u0438 \u0434\u0430\u043D\u043D\u044B\u0445 \u0433\u043E\u043D\u043A\u0438",type:"error"})}};return(n,a)=>(e(),l(b,null,[(e(!0),l(b,null,V(o.value,(y,s)=>(e(),l("div",{class:"race-table__item race-table__result",key:s},[w(t("input",{type:"number","onUpdate:modelValue":_=>o.value[s]=_,placeholder:"\u041F\u0440\u0438\u0445\u043E\u0434"},null,8,st),[[I,o.value[s]]]),w(t("input",{type:"text","onUpdate:modelValue":_=>h.value[s]=_,placeholder:"\u041C\u0435\u0442\u043A\u0430",class:"race-table__tag"},null,8,ot),[[I,h.value[s]]])]))),128)),t("div",{class:"race-table__item race-table__result"},[t("button",{onClick:d},"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C")])],64))}},nt=O(lt,[["__scopeId","data-v-5d16785c"]]),it={class:"race-table"},ct={key:0},ut={class:"race-table__header"},rt={class:"race-table__row"},dt=t("div",{class:"race-table__item race-table__name"},"\u041A\u043E\u043C\u0430\u043D\u0434\u0430",-1),_t=t("div",{class:"race-table__item race-table__total"},"\u0418\u0442\u043E\u0433",-1),pt={class:"race-table__body"},vt={class:"race-table__column"},mt={key:0,class:"race-table__item race-table__result"},ft=["onClick"],gt={class:"race-table__column"},ht={__name:"AppRaceTable",props:["stageId","status","groupId"],setup(g){const i=g,r=c({}),u=c({}),o=c(),h=c(),$=c({default:"\u0413\u043E\u043D\u043A\u0430",group:"\u0413\u0440\u0443\u043F\u043F\u0430",fleet:"\u0424\u043B\u043E\u0442"}),d=z(()=>{var s;return(s=Object.keys(r.value).length)!=null?s:0}),n=async()=>{try{const s=await axios.get(`/api/admin/stage/${i.stageId}/${i.groupId}/${i.status}/total`);h.value=s.data}catch(s){console.log(s.message)}};T(async()=>{try{const s=await axios.get(`/api/admin/stage/${i.stageId}/races/${i.status}/group/${i.groupId}`);r.value=s.data,o.value=r.value[0].race_id;const _=await axios.get(`/api/admin/race/${o.value}/teams`);u.value=_.data,await n()}catch(s){console.log(s.message)}});const a=async()=>{try{const _=(await axios.post("/api/admin/race/create",{stage_id:i.stageId,group_id:i.groupId,status:i.status,lastRaceId:o.value})).data;r.value.push({race_id:_.id,group_id:_.group_id,status:_.status}),await n()}catch(s){console.log(s.message)}},y=async s=>{try{await axios.post(`/api/admin/race/${s}/remove`),r.value.splice(r.value.findIndex(_=>_.race_id===s),1),await n()}catch(_){console.log(_.message)}};return(s,_)=>(e(),l("div",it,[s.$props.status?(e(),l("h2",ct,k($.value[s.$props.status])+" #"+k(s.$props.groupId),1)):x("",!0),t("button",{class:"btn btn-default btn-settings mb15",onClick:a},"\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u0433\u043E\u043D\u043A\u0443"),t("div",ut,[t("div",rt,[dt,(e(!0),l(b,null,V(U(d),m=>(e(),l("div",{class:"race-table__item race-table__result",key:m},"#"+k(m),1))),128)),_t])]),t("div",pt,[t("div",vt,[(e(!0),l(b,null,V(u.value,m=>(e(),l("div",{class:"race-table__item race-table__name",key:m.team_id},k(m.team_name),1))),128))]),(e(!0),l(b,null,V(r.value,(m,S)=>(e(),l("div",{class:"race-table__column",key:m.race_id},[N(nt,{raceId:m.race_id,onUpdate:n},null,8,["raceId"]),r.value.length>1&&S+1!==1?(e(),l("div",mt,[t("button",{onClick:A=>y(m.race_id)},"\u0423\u0434\u0430\u043B\u0438\u0442\u044C",8,ft)])):x("",!0)]))),128)),t("div",gt,[(e(!0),l(b,null,V(h.value,(m,S)=>(e(),l("div",{class:"race-table__item race-table__total",key:S},k(m),1))),128))])])]))}},yt={__name:"TheStageStatus",props:["status","id"],emits:["update"],setup(g,{emit:i}){const r=g,u=c(r.status),o=r.id,h=F(),$=async()=>{try{const a=await M.post(`/api/admin/stage/${o}/start`);u.value=a.data.status,i("update",u.value)}catch(a){console.log(a.message),h.dispatch("notification/displayMessage",{value:a.response.data.message,type:"error"})}},d=async()=>{try{const a=await M.post(`/api/admin/stage/${o}/finish-group`);u.value=a.data.status,i("update",u.value)}catch(a){console.log(a.message),h.dispatch("notification/displayMessage",{value:a.response.data.message,type:"error"})}},n=async()=>{try{const a=await M.post(`/api/admin/stage/${o}/finish`);u.value=a.data.status,i("update",u.value)}catch(a){console.log(a.message),h.dispatch("notification/displayMessage",{value:a.response.data.message,type:"error"})}};return(a,y)=>(e(),l(b,null,[u.value==="active"?(e(),l("button",{key:0,class:"btn btn-default btn-settings",onClick:$},"\u041D\u0430\u0447\u0430\u0442\u044C \u044D\u0442\u0430\u043F")):x("",!0),u.value==="group"?(e(),l("button",{key:1,class:"btn btn-default btn-settings",onClick:d},"\u0417\u0430\u0432\u0435\u0440\u0448\u0438\u0442\u044C \u0433\u0440\u0443\u043F\u043F\u043E\u0432\u043E\u0439 \u044D\u0442\u0430\u043F")):x("",!0),u.value==="default"||u.value==="fleet"?(e(),l("button",{key:2,class:"btn btn-default btn-settings",onClick:n},"\u0417\u0430\u0432\u0435\u0440\u0448\u0438\u0442\u044C \u0440\u0435\u0433\u0430\u0442\u0443")):x("",!0)],64))}};const R=g=>(J("data-v-86f09e6f"),g=g(),P(),g),bt={class:"dashboard-item"},$t=R(()=>t("h3",null,"\u0417\u0430\u0433\u0440\u0443\u0436\u0435\u043D\u043D\u044B\u0435 \u0444\u0430\u0439\u043B\u044B",-1)),xt={class:"docs-container"},kt=["onClick"],wt=["href"],It={key:0,class:"ri-file-pdf-2-line"},Vt=["src"],St={class:"docs-title"},Ct={class:"dashboard-item"},Ut=R(()=>t("h3",null,"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044C \u0444\u0430\u0439\u043B\u044B",-1)),At=["onSubmit"],Mt={class:"form-control"},Tt=R(()=>t("label",{for:"file"},"\u0424\u0430\u0439\u043B",-1)),Rt={class:"form-control"},Dt=R(()=>t("label",{for:"title"},"\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435",-1)),Ft=R(()=>t("button",{class:"btn btn-default btn-settings"},"\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C",-1)),Gt={__name:"StageFiles",props:["id"],setup(g){const i=g,r=c([]),u=c(),o=c();T(async()=>{const d=await axios.get(`/api/admin/stage/${i.id}/files`);d.data.result&&(r.value=[...d.data.files])});const h=async()=>{const d=new FormData;if(d.append("file",u.value.files[0]),d.append("title",o.value),d.append("id",i.id),!u.value.files[0]||!o.value){alert("\u041E\u0448\u0438\u0431\u043A\u0430, \u043E\u0431\u0430 \u043F\u043E\u043B\u044F \u0434\u043E\u043B\u0436\u043D\u044B \u0431\u044B\u0442\u044C \u0437\u0430\u043F\u043E\u043B\u043D\u0435\u043D\u044B!");return}const n=await axios.post("/api/admin/stage/file",d,{headers:{"Content-Type":"multipart/form-data"}});n.data.result===!0&&(r.value.push(n.data.file),u.value=null,o.value=null)},$=async d=>{if((await axios.delete(`/api/admin/stage/file/${d}/delete`)).data.result){const a=r.value.findIndex(y=>y.id===d);r.value.splice(a,1)}};return(d,n)=>(e(),l(b,null,[t("div",bt,[$t,t("div",xt,[(e(!0),l(b,null,V(r.value,a=>(e(),l("div",{class:"docs-item",key:a.id},[t("div",{class:"doc-delete",onClick:y=>$(a.id)},"\u0423\u0434\u0430\u043B\u0438\u0442\u044C",8,kt),t("a",{href:"/storage/"+a.path,class:"docs-img",target:"_blank"},[a.path.includes("pdf")?(e(),l("i",It)):(e(),l("img",{key:1,src:"/storage/"+a.path,alt:"doc-img"},null,8,Vt))],8,wt),t("div",St,k(a.title),1)]))),128))])]),t("div",Ct,[Ut,t("form",{onSubmit:H(h,["prevent"])},[t("div",Mt,[Tt,t("input",{type:"file",id:"file",name:"file",ref_key:"fileInput",ref:u},null,512)]),t("div",Rt,[Dt,w(t("input",{class:"form-input",type:"text",name:"title","onUpdate:modelValue":n[0]||(n[0]=a=>o.value=a)},null,512),[[I,o.value]])]),Ft],40,At)])],64))}},jt=O(Gt,[["__scopeId","data-v-86f09e6f"]]);const Bt=g=>(J("data-v-4b1ffacd"),g=g(),P(),g),Nt={key:0,class:"result-table"},Ot=Bt(()=>t("thead",null,[t("tr",null,[t("th",null,"#"),t("th",null,"\u041A\u043E\u043C\u0430\u043D\u0434\u044B"),t("th",null,"\u0413\u0440\u0443\u043F\u043F\u0430"),t("th",null,"\u0423\u0434\u0430\u043B\u0435\u043D\u0438\u0435")])],-1)),Et={class:"result-table__name"},Lt={class:"result-table__first"},qt={class:"result-table__second"},Ht=["onUpdate:modelValue"],Jt=["onClick"],Pt={__name:"TeamsSplit",props:["id"],setup(g){const i=g,r=c([]),u=c({}),o=F(),h=async()=>{if(Object.keys(u.value).length!==r.value.length){o.dispatch("notification/displayMessage",{type:"error",value:"\u0420\u0430\u0441\u043F\u0440\u0435\u0434\u0435\u043B\u0438\u0442\u0435 \u0432\u0441\u0435 \u043A\u043E\u043C\u0430\u043D\u0434\u044B \u0438\u043B\u0438 \u0443\u0434\u0430\u043B\u0438\u0442\u0435 \u043B\u0438\u0448\u043D\u0438\u0435"});return}const n=await axios.post(`/api/admin/stage/${i.id}/group`,{groups:u.value});n.data.result?console.log(n.data):o.dispatch("notification/displayMessage",{type:"error",value:"\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u043E\u043F\u0440\u043E\u0431\u0443\u0439\u0442\u0435 \u043F\u043E\u0437\u0436\u0435"})},$=async n=>{const a=await axios.post(`/api/admin/remove-team/${n}/stage/${i.id}`);a.data.result?(o.dispatch("notification/displayMessage",{type:"primary",value:"\u041A\u043E\u043C\u0430\u043D\u0434\u0430 \u0443\u0434\u0430\u043B\u0435\u043D\u0430"}),await d()):o.dispatch("notification/displayMessage",{type:"error",value:a.data.msg})},d=async()=>{const n=await axios.get(`/api/admin/team/users/${i.id}`);n.data.result&&(r.value=n.data.teams)};return T(async()=>{await d()}),(n,a)=>(e(),l(b,null,[r.value.length>0?(e(),l("table",Nt,[Ot,t("tbody",null,[(e(!0),l(b,null,V(r.value,(y,s)=>(e(),l("tr",{key:s},[t("td",null,k(s+1),1),t("td",null,[t("div",Et,[t("div",Lt,k(y.team_name),1),t("div",qt,[(e(!0),l(b,null,V(y.users,_=>(e(),l("span",{key:_.id},k(_.surname)+" "+k(_.name)+" "+k(_.patronymic),1))),128))])])]),t("td",null,[w(t("input",{class:"split-number-input",type:"number","onUpdate:modelValue":_=>u.value[y.team_id]=_},null,8,Ht),[[I,u.value[y.team_id]]])]),t("td",null,[t("button",{class:"btn btn-default btn-settings",onClick:_=>$(y.team_id)},"\u0423\u0434\u0430\u043B\u0438\u0442\u044C",8,Jt)])]))),128))])])):x("",!0),t("button",{class:"btn btn-default btn-settings",onClick:h},"\u0421\u0444\u043E\u0440\u043C\u0438\u0440\u043E\u0432\u0430\u0442\u044C \u0433\u0440\u0443\u043F\u043F\u044B")],64))}},Qt=O(Pt,[["__scopeId","data-v-4b1ffacd"]]),Xt={class:"container-fluid g-0"},Yt={class:"row"},zt={class:"col-12"},Kt={class:"dashboard-item"},Wt=["onSubmit"],Zt={class:"form-control"},te=t("label",{for:"register_start"},"\u041D\u0430\u0447\u0430\u043B\u043E \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u0438",-1),ee={class:"form-control"},ae=t("label",{for:"register_end"},"\u041A\u043E\u043D\u0435\u0446 \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u0438",-1),se={class:"form-control"},oe=t("label",{for:"title"},"\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u042D\u0442\u0430\u043F\u0430",-1),le={class:"form-control"},ne=t("label",{for:"race_amount_drop"},"\u041A\u043E\u043B-\u0432\u043E \u0432\u044B\u0431\u0440\u043E\u0441\u043E\u0432 (\u0434\u043E 18 \u0447\u0435\u043B\u043E\u0432)",-1),ie={class:"form-control"},ce=t("label",{for:"race_amount_drop"},"\u041A\u043E\u043B-\u0432\u043E \u0432\u044B\u0431\u0440\u043E\u0441\u043E\u0432 \u0432 \u0433\u0440\u0443\u043F\u043F\u0430\u0445 (\u043E\u0442 19 \u0447\u0435\u043B\u043E\u0432)",-1),ue={class:"form-control"},re=t("label",{for:"race_amount_drop"},"\u041A\u043E\u043B-\u0432\u043E \u0432\u044B\u0431\u0440\u043E\u0441\u043E\u0432 \u0432\u043E \u0444\u043B\u043E\u0442\u0430\u0445 (\u043E\u0442 19 \u0447\u0435\u043B\u043E\u0432)",-1),de={class:"form-control"},_e=t("label",{for:"excerpt"},"\u041A\u0440\u0430\u0442\u043A\u043E\u0435 \u043E\u043F\u0438\u0441\u0430\u043D\u0438\u0435",-1),pe={class:"form-control"},ve=t("label",{for:"description"},"\u041E\u043F\u0438\u0441\u0430\u043D\u0438\u0435",-1),me={class:"form-control"},fe=t("label",{for:"participant_text"},"\u0414\u043B\u044F \u0443\u0447\u0430\u0441\u0442\u043D\u0438\u043A\u043E\u0432",-1),ge=t("button",{class:"btn btn-default btn-settings"},"\u0420\u0435\u0434\u0430\u043A\u0442\u0438\u0440\u043E\u0432\u0430\u0442\u044C",-1),he={class:"col-12"},ye={class:"col-12"},be={class:"dashboard-item"},Ve={__name:"edit",setup(g){const i=c(!1),r=K(),u=F(),o=r.params.id,h=c(),$=c(""),d=c(""),n=c(""),a=c(""),y=c(""),s=c(""),_=c(),m=c(),S=c(),A=c(),D=c(),G=c(null),E=c(),j=c(1),L=async p=>{try{const v=await axios.get(`/api/admin/stage/${o}/meta`);E.value=v.data,m.value=p,j.value&&j.value++}catch(v){console.log(v.message)}};T(async()=>{i.value=!0;try{const p=await axios.get(`/api/admin/stage/${o}/edit`);n.value=h.value=p.data.title,$.value=p.data.register_start,d.value=p.data.register_end,a.value=p.data.excerpt?p.data.excerpt:" ",y.value=p.data.description?p.data.description:" ",s.value=p.data.participant_text?p.data.participant_text:" ",_.value=p.data.users,S.value=p.data.race_amount_drop,A.value=p.data.race_amount_group_drop,D.value=p.data.race_amount_fleet_drop,await L(p.data.status),i.value=!1}catch(p){console.log(p.message),i.value=!1}});const Q=async()=>{i.value=!0;try{if(await axios.patch(`/api/admin/stage/${o}/update`,{title:n.value,description:y.value,excerpt:a.value,participant_text:s.value,register_start:$.value,register_end:d.value,race_amount_drop:S.value,race_amount_group_drop:A.value,race_amount_fleet_drop:D.value}),G.value)for(let p of G.value)p.getTotal();u.dispatch("notification/displayMessage",{value:"\u042D\u0442\u0430\u043F \u0443\u0441\u043F\u0435\u0448\u043D\u043E \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D",type:"primary"}),i.value=!1}catch(p){console.log(p.message),u.dispatch("notification/displayMessage",{value:"\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u0438\u0438 \u044D\u0442\u0430\u043F\u0430",type:"error"}),i.value=!1}};return(p,v)=>(e(),l(b,null,[N(at,null,{default:W(()=>[Z(k(h.value),1)]),_:1}),t("main",null,[t("div",Xt,[t("div",Yt,[t("div",zt,[t("div",Kt,[i.value?(e(),C(et,{key:0})):x("",!0),t("form",{onSubmit:H(Q,["prevent"])},[t("div",Zt,[te,w(t("input",{class:"form-input",type:"datetime-local",id:"register_start","onUpdate:modelValue":v[0]||(v[0]=f=>$.value=f)},null,512),[[I,$.value]])]),t("div",ee,[ae,w(t("input",{class:"form-input",type:"datetime-local",id:"register_end","onUpdate:modelValue":v[1]||(v[1]=f=>d.value=f)},null,512),[[I,d.value]])]),t("div",se,[oe,w(t("input",{class:"form-input",type:"text",id:"title","onUpdate:modelValue":v[2]||(v[2]=f=>n.value=f),placeholder:"\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u044D\u0442\u0430\u043F\u0430"},null,512),[[I,n.value]])]),t("div",le,[ne,w(t("input",{class:"form-input",type:"text",id:"race_amount_drop","onUpdate:modelValue":v[3]||(v[3]=f=>S.value=f),placeholder:"\u041A\u043E\u043B-\u0432\u043E \u0432\u044B\u0431\u0440\u043E\u0441\u043E\u0432 (\u0434\u043E 18 \u0447\u0435\u043B\u043E\u0432)"},null,512),[[I,S.value]])]),t("div",ie,[ce,w(t("input",{class:"form-input",type:"text",id:"race_amount_group_drop","onUpdate:modelValue":v[4]||(v[4]=f=>A.value=f),placeholder:"\u041A\u043E\u043B-\u0432\u043E \u0432\u044B\u0431\u0440\u043E\u0441\u043E\u0432 \u0432 \u0433\u0440\u0443\u043F\u043F\u0430\u0445 (\u043E\u0442 19 \u0447\u0435\u043B\u043E\u0432)"},null,512),[[I,A.value]])]),t("div",ue,[re,w(t("input",{class:"form-input",type:"text",id:"race_amount_fleet_drop","onUpdate:modelValue":v[5]||(v[5]=f=>D.value=f),placeholder:"\u041A\u043E\u043B-\u0432\u043E \u0432\u044B\u0431\u0440\u043E\u0441\u043E\u0432 \u0432\u043E \u0444\u043B\u043E\u0442\u0430\u0445 (\u043E\u0442 19 \u0447\u0435\u043B\u043E\u0432)"},null,512),[[I,D.value]])]),t("div",de,[_e,a.value?(e(),C(B,{key:0,modelValue:a.value,"onUpdate:modelValue":v[6]||(v[6]=f=>a.value=f),id:"excerpt"},null,8,["modelValue"])):x("",!0)]),t("div",pe,[ve,y.value?(e(),C(B,{key:0,modelValue:y.value,"onUpdate:modelValue":v[7]||(v[7]=f=>y.value=f),id:"description"},null,8,["modelValue"])):x("",!0)]),t("div",me,[fe,s.value?(e(),C(B,{key:0,modelValue:s.value,"onUpdate:modelValue":v[8]||(v[8]=f=>s.value=f),id:"participant_text"},null,8,["modelValue"])):x("",!0)]),ge],40,Wt)])]),t("div",he,[N(jt,{id:U(o)},null,8,["id"])]),t("div",ye,[t("div",be,[m.value==="active"?(e(),C(Qt,{key:0,id:U(o)},null,8,["id"])):x("",!0),m.value!=="finished"&&m.value!=="active"?(e(!0),l(b,{key:1},V(E.value,(f,X,Y)=>(e(),l("div",{class:"stage-table",key:Y},[(e(!0),l(b,null,V(f,q=>(e(),C(ht,{stageId:U(o),groupId:q,status:X,key:q,ref_for:!0,ref_key:"child",ref:G},null,8,["stageId","groupId","status"]))),128))]))),128)):x("",!0),m.value?(e(),C(yt,{key:2,status:m.value,id:U(o),onUpdate:L},null,8,["status","id"])):x("",!0),m.value!=="active"?(e(),C(tt,{id:U(o),key:j.value},null,8,["id"])):x("",!0)])])])])])],64))}};export{Ve as default};
